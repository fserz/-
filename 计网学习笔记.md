#　计网学习笔记

## 物理层

数据链路层 - **点对点**

传输层 - **端到端**

曼彻斯特编码  **前高后低**为**1**，**前低后高**为**0**。

**差分**曼彻斯特编码  后一个波形和前一个的波形**相同**，则后一个波形**表示0**，如果波形**不同**，则**表示1**

4B/5BB编码  **编码效率80%**

数据到*模拟*信号 - **调制** 

数据到*数字*信号 - **编码**

模拟数据编码为数字信号：

1. 采样  f采样 >= 2f max(信号最大频率)
2. 量化
3. 编码

### 电路交换、报文交换、与分组交换

#### 电路交换

数据传输前必须先建立一条专用（双方独占）的物理通信路径，这一路径在整个数据传输工程中一直被独占，直到通信结束后才被释放。

电路交换分为三个阶段：**连接建立**、**数据传输**和**连接释放**。

#### 报文交换

数据交换的单位是报文，报文携带有**目的地址、源地址**等信息。报文交换在交换结点采用的是**存储转发**的传输模式。

#### 分组交换

分组：把大的数据块分割成小的数据块。

同报文交换一样，分组交换也采用**存储转发**模式，但解决了报文交换中大报文传输的问题。分组交换限制了每次传送的数据块大小的上限，把大的数据块划分为合理的小数据块，在**加上一些必要的控制信息**（如源地址、目的地址和编号信息等），构成分组。网络结点根据控制信息把分组送到下一个结点，下一个结点接受到分组后，暂时保存并排队等待传输，然后根据分组控制信息选择它的下一个结点，直到达到目的结点。

##### 数据报与虚电路

分组交换根据通信子网向端点系统提供的服务，还可进一步分为*面向连接*的**虚电路方式**和*无连接*的**数据报方式**。

1. **数据报**

作为通信子网用户的端系统发送一个报文时，在端系统中实现的高层协议先把报文拆成若干带有序号的数据单元，并在网络层加上地址等控制信息后形成数据报分组（即网络的PDU)。

2. **虚电路**

虚电路方式试图将数据报与电路交换方式结合起来，充分发挥两种方法的优点，以达到最佳的数据交换效果。在分组发送之前，要求在发送方和接收方建立一条逻辑上相连的虚电路，并且连接一旦建立，就固定了虚电路所对应的物理路径。整个通信过程分为三个阶段：**虚电路建立**、**数据传输**与**虚电路释放**。

|                    |                          数据报服务                          |                        虚电路服务                        |
| :----------------: | :----------------------------------------------------------: | :------------------------------------------------------: |
|     连接的建立     |                            **无**                            |                        **必须有**                        |
|      目的地址      |                每个分组都有**完整的**目的地址                | 仅在建立连接阶段使用，之后每个分组使用长度较短的虚电路号 |
|      路由选择      |                每个分组独立进行路由选择和转发                |           属于一条虚电路的分组按照同一路由转发           |
|      分组顺序      |                   **不保证**分组的有序到达                   |                **保证**分组的**有序到达**                |
|       可靠性       |             不保证可靠通信，可靠性由用户机来保证             |                     可靠性由网络保证                     |
| 对网络故障的适应性 | 出故障的结点丢失分组，其他分组路径选择发生变化时可以正常传输 |          所有经过故障结点的虚电路均不能正常工作          |
| 差错处理和流量控制 |          由用户主机进行流量控制，不保证数据的可靠性          |           可由分组交换网负责，也可由用户机负责           |



### 奈氏准则和香农定理

1. **奈氏准则**

***理想信道**下的极限数据传输率 = 2W㏒₂V（单位b/s）*

 W为理想信道带宽，单位Hz V表示每个码元离散电平数目

2. **香农定理**

*信道的极限传输速率 = W㏒₂（1 + S/N）*

W为带宽。单位Hz，S/N为信噪比，单位为1。信噪比 = 10㏒*10*(S/N) 单位为dB,如S/N = 10，信噪比 = 10dB，当S/N=1000，信噪比为30dB

## 数据链路层

网桥、以太网交换机

**有连接一定有确认**  链路层为网络层提供服务：

1. 无确认无连接
2. 确认无连接
3. 有确认面向连接

**流量控制**：限制**发送方**数据流量，使其发送速率不超过接收方的接受能力。

流量控制**并不是**链路层特有的，数据链路层控制的是相邻**两节点**之间的数据流量，运输层控制的是从**源端到目的端**的流量。

发送方连续五个“1”，在其后插入一个“0”，接收方遇见连续五个“1”自动删除“0”。(**5110**)

奇偶校验码只能**发现奇数位**错误。

### ARQ

1. **停止等待ARQ**协议 ：发送窗口 = 1，接受窗口 = 1    **（=1,=1）**

2. **后退N帧ARQ**协议：发送窗口  > 1，接受窗口 = 1  **累计确认**，对n号帧确认，则n号及之前的所有帧均已正确收到。**（>1, =1）**

   发送窗口 1 <=WT<=**2n次方 - 1** 

3. **选择重传ARQ**协议：发送窗口  > 1，接受窗口  > 1 **逐一确认，只重传出错帧**。   **(>1,>1)**

   发送窗口WT = 接受窗口WR = **2(n - 1)次方** 

多路复用：将多个输入通道信息整合到一个复用通道中，在接收端把收到的信息分离出来并传到对应的输出通道。

1. 频分多路复用
2. 时分多路复用
3. 波分多路复用
4. 码分多路复用
5. 频分多路复用

### 随机访问介质访问控制协议：

1. #### ALOHA协议  ：

   (1)*纯*ALOHA协议 **想发就发，超时后等一随机时间再重传。**  

   (2) *时隙*ALOHA协议 **控制想发就发的随意性，将时间划分为一段段等长的时隙，规定只能在时隙开始时才能发送一个帧，碰撞处理与纯ALOHA协议相似。**

2. #### CSMA协议  ***先听再说***

   （1）*1坚持*CSMA  **空则直接传输，不必等待。忙则一直监听，直到空闲马上传输。**

   （2）*非坚持*CSMA **空则直接传输，不必等待。忙则等待一个随机时间再监听。**

   （3）*p坚持*CSMA **空则则以概率p直接传输，不必等待， 概率1-p等到下一个时隙在传输。忙则等待一个随机时间再监听。**

3. #### CSMA/CD协议  **先听再发， 边听边发，冲突停发，随机重发**

只能**半双工**通信。用于**以太网**。

争用期/冲突窗口/碰撞窗口：**2τ**(传输时延的2倍)

（最迟2τ知道自己发送的数据没碰撞）

**最小帧长** = 2 * 总线传播时长(τ)* 数据传输速率

**以太网**最小帧长为**64B**

*CSMA/CD*采用**二进制退避算法**解决碰撞问题：

（1）基本退避时间一般取2τ

（2）重传次数k， k=min｛重传次数， 10｝

（3）{0,1,2,3...,**2k次方 -1**}中随机选择一个r，所需退避时间即为**2rτ**

（4）最大重传次数**16次**，之后抛弃帧，报告出错

4. #### CSMA/CA协议

   在发送数据时先广播告知其他节点，让其他节点在某段时间内不发送数据，以免发生碰撞。

   用于**无线局域网**。

令牌是一组特殊比特组成的**帧**。

以太网，*逻辑拓扑* **总线**结构，*物理拓扑* **星形**结构。

令牌环网，*逻辑拓扑* **环形**结构，*物理拓扑* **星形**结构。

FDI，*逻辑拓扑* **环形**结构，*物理拓扑* **双环**结构。

- 802.3 - 以太网 只实现*差错接收*，**不实现**可靠传输。**不可靠**
- 802.5 - 令牌环网
- 802.8 - FDI（光纤）
- 802.11 - WLAN

以太网帧长数据:46~1500字节  最大传送单元MTU = **1500B** 最小帧长**64B** 数据字段最短 = 64 -18(MAC帧的首部和尾部) = 46B

**PPP协议**和**HDLC协议**是广域网数据链路层控制协议：

### PPP协议（点对点协议）

只支持**全双工，面向字节，点对点，只保证无差错接收，不提供纠错，不可靠**

信息段 0 - 1500B

### HDLC协议

**面向比特，全双工**

| ＰＰＰ协议 | 面向字节 | ２Ｂ协议字段 | 无序号和确认机制 | 不可靠 |
| :--------: | :------: | :----------: | :--------------: | :----: |
|  HDLC协议  | 面向比特 |      无      |        有        |  可靠  |

***物理层设备（中继器、集线器）*** **既不**能隔离冲突域**也不**能隔离广播域，***链路层设备（网桥、交换机）*** **只能**隔离冲突域**不能**隔离广播域，***网络层设备（路由器）*** **都可以**隔离冲突域和广播域。

##　网络层

只**尽可能交付**数据，不管是否出错、丢失。

|     物理层     |  数据链路层  | 网络层 | 网络层以上 |
| :------------: | :----------: | :----: | :--------: |
| 中继器、集线器 | 网桥、交换机 | 路由器 |    网关    |

路由器实现两个功能

- **路由选择**  确定哪一条路径
- **分组交换**  当一个分组到达时所采取的动作

**流量控制**是指在发送端和接收端之间的**点对点**通信量的控制。**拥塞控制**确保通信子网能够传送待传送数据，是一个**全局性问题**。

### IPV4

地址**32位**，4B

长度单位 **一种**（1总）**八片**（8片）**首饰**（首4）。

| 总长度 | 片偏移 | 首部长度 |
| :----: | :----: | :------: |
|   1B   |   8B   |    4B    |

以太网MTU = 1500B， >MTU则**分片**。

**IP地址 =｛网络号， 主机号｝**

- A类 网络号8位 主机号24位 **0开头**
- B类 网络号16位 主机号16位 **10开头**
- C类 网络号24位 主机号8位 **110开头**
- D类 **1110开头** 多播地址
- E类 **1111开头** 今后使用

主机号**全0**为**网络本身**，主机号**全1**为**广播地址**。

127.0.0.0为**环回自检地址**。

### NAT（网络地址转换）

将**专用网络地址**转换为**公用地址**。

私有IP地址，**只用于LAN**，不用于WAN：

- A类：**10**.0.0.0 - **10**.255.255.255
- B类：**172.16**.0.0 - **172.31**.255.255 
- C类：**192.168.0**.0 - **192.168.255**.255

**普通路由器**，工作在网络层，转发数据报时，**不改变**其源IP地址和目的IP地址。**NAT路由器**需要查看和转换**传输层**的端口号，在转发数据报时，**一定要更换**其IP地址。

### 子网划分和CIDR

子网划分：从主机号借用若干比特作为子网号。

**IP地址=｛网络号，子网号，主机号｝**

IPV4和CIDR，子网中的主机号全0全1都**不能**被指派，全0为的地址为子网网络号，主机号全1的地址为子网的广播地址。

**子网掩码**：由一串连着的1和跟随的一串0组成。**1**对应与IP中的**网络号和子网号**，**0**对应于**主机号**。

 IP地址    **AND(与操作)**   子网掩码   =  子网网络地址

IP地址     **AND(与操作) **  子网掩码取反  =   主机号

| 10000000 | 128  |
| :------: | :--: |
| 11000000 | 192  |
| 11100000 | 224  |
| 11110000 | 240  |
| 11111000 | 248  |
| 11111100 | 252  |
| 11111110 | 254  |
| 11111111 | 255  |

**CIDR(无分类局域间路由选择)**：变长子网掩码基础上提出的一种消除A、B、C类网络划分，并且可以在软件的支持下实现超网构造的一种IP地址的划分方法。

CIDR使用网络前缀代替子网络。斜线记法，即**IP地址/网络前缀**所占的比特数。

**IP = ｛网络前缀， 主机号｝**

使用CIDR采用**最长前缀匹配**，查找路由表可嫩得到不止一个结果，**选网络前缀更长的**，结果更准确。

**ARP（地址解析）** IP地址到MAC地址层 **网络层**协议

**DHCP（动态主机分配）** 给主机动态的分配IP地址。基于UDP，**应用层**协议。

**ICMP(网际报文控制协议)**让主机或路由器*报告差错和异常状况*。

ICMP分为两类：

* ICMP差错报告报文
* ICMP询问报文

PING工作在**应用层**，它直接使用网络层的ICMP。

### IPV6

地址位**128位**，16B。

IPV4向IPV6过渡采用：双协议栈和隧道技术。

### 路由协议

**IGP（内部网关协议）**：自制系统内部使用的路由协议。                                         

* **RIP**

**最多15**跳，**16**即为**不可达**。使用**UDP**，**应用层**协议。

缺点：**好消息**传的**快**，**坏消息**传的**慢**。

* **OSPF**，**网络层**协议，直接用**IP数据报**传送。

**OSPF**向**所有路由器**发送信息，使用**洪范法**。**RIP**仅向**自己相邻的**几个路由器。

**EGP（外部网关协议）**：源站和目的站在不同的自制系统中。

​      **BGP**，**应用层**协议，基于**TCP**。

单播 点对点

广播 点对多点

组播（多播） 点对多点  仅用于UDP

IP组播使用D类地址格式。

**IGMP(因特网组管理协议)**

IGMP让连接到本地局域网上的组播路由器知道本局域网上是否有主机参加或退出了某个组波段。

##　传输层

传输层提供**端到端的通信。**

**TCP**，**可靠，面向连接**，时延大，适用于**大**文件，**全双工**。

**UDP**，**无连接，不可靠**，面向报文，时延小，适用于**小**文件。

端口号只具有**本地意义**。

| FTP  | TELENET | SMTP | DNS  | HTTP |
| :--: | :-----: | :--: | :--: | :--: |
|  21  |   23    |  25  |  53  |  80  |

**套接字SOCKET**

网络中通过**IP地址**来标识不同**主机**，通过**端口号**来标识主机中的不同**应用进程**，端口号拼接到IP地址构成**套接字**。

**套接字 = （IP地址 ：端口号)**　　**唯一的标识网络中的一台主机和其上的一个应用进程**。

**TCP**应用：FTP, HTTP, TELENET

**UDP**应用：TFTP（小文件传输协议）, DNS, SNMP, RTP（实时传输协议）

TCP**建立连接**：**三次**握手

1. SYN = 1,seq = x
2. SYN = 1,ACK = 1, seq = y, ack =x + 1
3. ACK = 1, seq = x + 1, ack = y + 1  

服务器的资源是在完成第二次握手时分配的，而客户端的资源是在完成第三次握手时分配的，这就使得服务器易于受到**SYN洪泛攻击**。

TCP**释放连接**：**四次**握手

1. FIN =1, seq = u
2. ACK = 1, seq = v, ack = u + 1
3. FIN = 1, ACK = 1, seq = w, ack = u + 1
4. ACK  = 1, seq = u＋１, ack = w + 1 

**ACK、SYN、FIN一定等于1**

可靠：保证接收方从缓冲区读出的字节流与发送方发出的字节流是完全一样的。

### TCP可靠传输

TCP默认使用**累计确认**

**超时**和**冗余ACK**将导致报文重传。

接收窗口rwnd：接受方根据目前接受缓存大小所许诺的最新窗口值，反映接收方的容量。

拥塞窗口cwnd：发送方根据自己估算的网络拥塞程度而设置的窗口值，反映网络当前容量。

**发送方的发送窗口 = min｛接收窗口rwnd，拥塞窗口cwnd｝**

传输层和数据链路层流量控制差别：传输层定义**端到端**用户之间的流量控制，数据链路层定义两个中间的**相邻节点**的流量控制，数据链路层的滑动窗口协议窗口大小**不能**动态变化，传输层的**可以**动态变化。

| **数据链路层** | **相邻节点** | **窗口不能动态变化** |
| :------------: | :----------: | :------------------: |
|   **传输层**   |  **端到端**  | **窗口可以动态变化** |

**拥塞控制**与**流量控制**的区别：**拥塞控制**是让网络能够承担现有的网络负荷，是一个**全局性过程**。**流量控制**往往是一个**点对点**的通信量控制。两者**都通过控制发送方**发送数据的速率来达到控制效果。

* cwnd < ssthresh ,使用**慢开始算法**
* cwnd > ssthresh ,使用**拥塞避免算法**
* cwnd = ssthresh 既可慢开始，又可拥塞避免（通常做法）

#### **慢开始算法**

初始cwnd = 1,每经过一个传输轮次（即往返时延RTT），cwnd就**加倍**，cwnd**指数式增长**，增长至**慢开始门限ssthresh（阈值）**，改用拥塞避免算法。

#### **拥塞避免算法**

每经过往返时延RTT将发送方的拥塞窗口cwnd**加1**，而不是加倍，使拥塞窗口cwnd按**线性规律缓**慢增大（即**加法增大**），这比慢开始算法的拥塞窗口增长要缓慢得多。

#### **网络拥塞处理**

无论在慢开始还是拥塞避免阶段，当发送方出现拥塞（未按时收到确认），把慢开始门限ssthresh设置为**出现拥塞时发送方的cwnd值的一半**（但不能小于2），然后将cwnd重新设为1，执行慢开始算法。

#### 快重传和快恢复

对慢开始算法和拥塞避免算法的改进

1. **快重传**

当发送方连续收到**三个重复的ACK报文**时，直接重传对方尚未接到的报文段，而不必等待那个报文段设置的重传超时计时器超时。

2. **快恢复**

当发送方收到**三个冗余ACK（即重复确认）时**，将慢开始门限ssthresh设置为此时发送方cwnd的一半。

由于跳过了拥塞窗口cwnd从1起始的慢开始过程，所以被称为快恢复。**跳过了慢开始阶段，直接将阈值减半开始拥塞避免算法，加法增大**。

四种方法的总结：在**TCP连接建立和网络出现超时**时，采用**慢开始和拥塞避免算法**；当发送方接受到**冗余ACK**时，采用**快重传和快恢复算法**。

## 应用层

### 客户/服务器模型（C/S）

Client/Server C/S  客户是服务器请求方，服务器是服务器提供方。

### P2P模型

peer - to - peer 每个节点都具有下载、上传的功能、其权利和义务都是大体对等的。

### DNS（域名系统）

把便于记忆的主机名转换为便于机器处理的IP地址。

DNS分为三部分：层次域名空间、域名服务器和解析器。

www.github.com   **低 → 高**

www 三级域名   github 二级域名 com顶级域名 

递归查询 - 靠别人

迭代查询 - 靠自己

### FTP(文件传输协议)

使用TCP

采用C/S工作方式。控制连接**始终连接**，数据连接**连接一会**。

是否使用TCP20端口号建立数据连接与**传输模式**有关。

* **主动**方式采用**TCP20端口**
* **被动**方式服务器和容器进行协商（端口 > 1024）

### 电子邮件

一种异步通信方式

发送采用**SMTP**协议， **TCP连接**，C/S,**端口号25**

接收采用**POP3**协议，**TCP连接**，C/S，**端口号110**

### WWW（万维网）

**URL** 统一自愿定位符

**HTTP** 超文本传输协议 应用层协议，**端口号80**，使用**TCP**进行可靠传输。

**HTML** 超文本标记语言 使用一些约定的标记对页面上的各种信息进行描述。 

- FTP数据连接     TCP       20
- FTP控制连接     TCP       21
- TELNET             TCP       23 
- SMTP                 TCP      25
- DNS                   UDP     53
- TFTP                  UDP     69
- HTTP                 TCP      80 
- POP3                 TCP     110
- SNMP                UDP    161

| FTP数据连接 | TCP  |  20  |
| :---------: | :--: | :--: |
| FTP控制连接 | TCP  |  21  |
|   TELNET    | TCP  |  23  |
|    SMTP     | TCP  |  25  |
|     DNS     | UDP  |  53  |
|    TFTP     | UDP  |  69  |
|    HTTP     | TCP  |  80  |
|    POP3     | TCP  | 110  |
|    SNMP     | UDP  | 161  |

















































 

































